services:
  # Development Environment
  console-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: guardstone-console-dev
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_API_URL=http://localhost:8000
    volumes:
      - .:/app
      - /app/node_modules
    command: npm run dev
    networks:
      - guardstone

  # Production-like Environment
  console-prod:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: guardstone-console-prod
    ports:
      - "3001:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_API_URL=http://api:8000
    depends_on:
      - api
    networks:
      - guardstone

  # Mock API Service (for testing)
  api:
    image: node:20-alpine
    container_name: guardstone-api-mock
    ports:
      - "8000:8000"
    environment:
      - PORT=8000
    command: node /app/api-server.js
    volumes:
      - ./api-server.js:/app/api-server.js
    networks:
      - guardstone
    profiles:
      - with-api

networks:
  guardstone:
    driver: bridge
